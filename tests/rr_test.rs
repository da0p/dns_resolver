use dns_resolver::client::message::DnsMessage;

#[test]
fn parse_resource_record() {
    let rr = vec![
        0x6e, 0x78, 0x80, 0x0, 0x0, 0x1, 0x0, 0x0, 0x0, 0x4, 0x0, 0x8, 0x3, 0x64, 0x6e, 0x73, 0x6,
        0x67, 0x6f, 0x6f, 0x67, 0x6c, 0x65, 0x3, 0x63, 0x6f, 0x6d, 0x0, 0x0, 0x1, 0x0, 0x1, 0xc0,
        0x10, 0x0, 0x2, 0x0, 0x1, 0x0, 0x2, 0xa3, 0x0, 0x0, 0x6, 0x3, 0x6e, 0x73, 0x32, 0xc0, 0x10,
        0xc0, 0x10, 0x0, 0x2, 0x0, 0x1, 0x0, 0x2, 0xa3, 0x0, 0x0, 0x6, 0x3, 0x6e, 0x73, 0x31, 0xc0,
        0x10, 0xc0, 0x10, 0x0, 0x2, 0x0, 0x1, 0x0, 0x2, 0xa3, 0x0, 0x0, 0x6, 0x3, 0x6e, 0x73, 0x33,
        0xc0, 0x10, 0xc0, 0x10, 0x0, 0x2, 0x0, 0x1, 0x0, 0x2, 0xa3, 0x0, 0x0, 0x6, 0x3, 0x6e, 0x73,
        0x34, 0xc0, 0x10, 0xc0, 0x2c, 0x0, 0x1c, 0x0, 0x1, 0x0, 0x2, 0xa3, 0x0, 0x0, 0x10, 0x20,
        0x1, 0x48, 0x60, 0x48, 0x2, 0x0, 0x34, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0xa, 0xc0, 0x2c,
        0x0, 0x1, 0x0, 0x1, 0x0, 0x2, 0xa3, 0x0, 0x0, 0x4, 0xd8, 0xef, 0x22, 0xa, 0xc0, 0x3e, 0x0,
        0x1c, 0x0, 0x1, 0x0, 0x2, 0xa3, 0x0, 0x0, 0x10, 0x20, 0x1, 0x48, 0x60, 0x48, 0x2, 0x0,
        0x32, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0xa, 0xc0, 0x3e, 0x0, 0x1, 0x0, 0x1, 0x0, 0x2,
        0xa3, 0x0, 0x0, 0x4, 0xd8, 0xef, 0x20, 0xa, 0xc0, 0x50, 0x0, 0x1c, 0x0, 0x1, 0x0, 0x2,
        0xa3, 0x0, 0x0, 0x10, 0x20, 0x1, 0x48, 0x60, 0x48, 0x2, 0x0, 0x36, 0x0, 0x0, 0x0, 0x0, 0x0,
        0x0, 0x0, 0xa, 0xc0, 0x50, 0x0, 0x1, 0x0, 0x1, 0x0, 0x2, 0xa3, 0x0, 0x0, 0x4, 0xd8, 0xef,
        0x24, 0xa, 0xc0, 0x62, 0x0, 0x1c, 0x0, 0x1, 0x0, 0x2, 0xa3, 0x0, 0x0, 0x10, 0x20, 0x1,
        0x48, 0x60, 0x48, 0x2, 0x0, 0x38, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0xa, 0xc0, 0x62, 0x0,
        0x1, 0x0, 0x1, 0x0, 0x2, 0xa3, 0x0, 0x0, 0x4, 0xd8, 0xef, 0x26, 0xa,
    ];

    let response = DnsMessage::parse(&rr);
    assert!(response.is_ok());
    let response = response.unwrap();
    let ip_addrs = response
        .additionals
        .iter()
        .filter(|rr| rr.is_host_addr())
        .map(|ar| ar.get_ip_addr())
        .collect::<Vec<String>>();

    assert_eq!(
        ip_addrs,
        vec![
            "216.239.34.10",
            "216.239.32.10",
            "216.239.36.10",
            "216.239.38.10"
        ]
    );
}
